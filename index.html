<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Car Security System</title>

<style>
:root{
  --bg1:#02040f;
  --bg2:#0a0f2c;
  --card:#0b1020cc;
  --stroke:#ffffff1a;
  --red:#ff3b30;
  --green:#34c759;
  --yellow:#ffcc00;
  --blue:#0a84ff;
  --text:#ffffff;
  --muted:#b0b4d4;
}

*{margin:0;padding:0;box-sizing:border-box}

body{
  font-family:system-ui,Arial;
  color:var(--text);
  min-height:100vh;
  overflow:hidden;
}

/* MOVING BACKGROUND */
.bg{
  position:fixed;
  inset:0;
  background:
    linear-gradient(120deg,var(--bg1),var(--bg2),var(--bg1));
  background-size:400% 400%;
  animation:bgMove 18s ease infinite;
  z-index:-3;
}
@keyframes bgMove{
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}

.blur{
  position:fixed;
  inset:0;
  backdrop-filter:blur(40px);
  background:#00000090;
  z-index:-2;
}

.wrap{
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:20px;
}

.card{
  width:min(960px,100%);
  background:var(--card);
  border:1px solid var(--stroke);
  border-radius:22px;
  box-shadow:0 30px 80px #000;
  padding:22px;
  display:grid;
  grid-template-columns:1.2fr .8fr;
  gap:18px;
}

@media(max-width:850px){
  .card{grid-template-columns:1fr}
}

h1{
  font-size:20px;
  margin-bottom:6px;
}
.sub{
  font-size:12px;
  color:var(--muted);
  margin-bottom:14px;
}

input,button{
  width:100%;
  padding:12px;
  border-radius:14px;
  border:1px solid var(--stroke);
  background:#0a0e1f;
  color:#fff;
  font-size:14px;
}

button{
  cursor:pointer;
  transition:.15s;
}
button:hover{transform:translateY(-1px)}

.row{display:grid;grid-template-columns:1fr 1fr;gap:10px}

.panel{
  border:1px solid var(--stroke);
  border-radius:18px;
  padding:14px;
  background:#080b18cc;
}

.label{
  font-size:11px;
  color:var(--muted);
  letter-spacing:.12em;
  text-transform:uppercase;
}

.value{margin-top:4px;font-size:15px}

.engine{
  display:flex;
  align-items:center;
  gap:12px;
  margin-top:10px;
}

.light{
  width:14px;height:14px;border-radius:50%;
  background:var(--red);
  box-shadow:0 0 14px var(--red);
}

.on{background:var(--green);box-shadow:0 0 16px var(--green)}
.valet{background:var(--yellow);box-shadow:0 0 16px var(--yellow)}

.alert{margin-top:10px;font-size:13px;min-height:20px}
.ok{color:var(--green)}
.bad{color:var(--red)}
.warn{color:var(--yellow)}

.log{
  max-height:260px;
  overflow:auto;
  border:1px solid var(--stroke);
  border-radius:14px;
  background:#050713;
}

.log div{
  padding:10px;
  border-bottom:1px solid #ffffff0f;
  font-size:12px;
}

small{font-size:11px;color:var(--muted)}
</style>
</head>

<body>
<div class="bg"></div>
<div class="blur"></div>

<div class="wrap">
<div class="card">

<!-- LEFT -->
<div>
<h1>Car Security System</h1>
<div class="sub">Auto-Lock • Cooldown • Recursion • User Password Control</div>

<input id="code" placeholder="Enter passcode">

<div class="row">
<button onclick="unlock()">Unlock</button>
<button onclick="startEngine()">Start Engine</button>
</div>

<div class="row">
<button onclick="lockSys()">Lock</button>
<button onclick="valetMode()">Valet</button>
</div>

<div class="alert" id="msg"></div>

<div class="panel">
<div class="label">Status</div>
<div class="value" id="state">LOCKED</div>

<div class="engine">
<div class="light" id="light"></div>
<div id="engineText">ENGINE OFF</div>
</div>

<div class="value">Fails: <span id="fails">0</span>/2</div>
</div>

<div class="panel">
<div class="label">Change Passwords</div>
<input id="newMaster" placeholder="New Master Code">
<input id="newValet" placeholder="New Valet Code">
<button onclick="saveCodes()">Save Codes</button>
<small>Saved permanently in browser</small>
</div>
</div>

<!-- RIGHT -->
<div>
<div class="panel">
<div class="label">Event Log</div>
<div class="log" id="log"></div>
</div>

<div class="panel">
<div class="label">Rules</div>
<small>
• 4–8 characters<br>
• letters + digits<br>
• 2 fails → cooldown<br>
• 60s inactivity → auto-lock
</small>
</div>
</div>

</div>
</div>

<script>
/* DEFAULT CODES */
let master = localStorage.getItem("master") || "1R2A";
let valet  = localStorage.getItem("valet")  || "123A";

let state="LOCKED";
let engine=false;
let fails=0;
let last=Date.now();
let cooldown=false;

function log(t){
  const d=document.createElement("div");
  d.textContent=new Date().toLocaleTimeString()+" - "+t;
  document.getElementById("log").prepend(d);
}

/* RECURSION */
function checkChars(code,i=0){
  if(i===code.length)return true;
  if(!/[A-Za-z0-9]/.test(code[i]))return false;
  return checkChars(code,i+1);
}

function valid(code){
  return code.length>=4 && code.length<=8 &&
         checkChars(code) &&
         /[A-Za-z]/.test(code) &&
         /[0-9]/.test(code);
}

function ui(){
  document.getElementById("state").textContent=state;
  document.getElementById("fails").textContent=fails;
  const l=document.getElementById("light");
  l.className="light";
  if(engine)l.classList.add("on");
  if(state==="VALET")l.classList.add("valet");
  document.getElementById("engineText").textContent=
    engine?"ENGINE ON":"ENGINE OFF";
}

function msg(t,c){
  const m=document.getElementById("msg");
  m.className="alert "+c;
  m.textContent=t;
}

function unlock(){
  if(cooldown)return msg("Cooldown active","bad");
  const c=code.value.trim();
  last=Date.now();

  if(!valid(c)){
    fails++;
    msg("Invalid format","bad");
    log("Invalid format");
  }
  else if(c===master){
    state="UNLOCKED";
    engine=true;
    fails=0;
    msg("Master accepted","ok");
    log("Master unlock");
  }
  else if(c===valet){
    state="VALET";
    engine=false;
    fails=0;
    msg("Valet mode","warn");
    log("Valet mode");
  }
  else{
    fails++;
    msg("Wrong code","bad");
    log("Wrong code");
  }

  if(fails>=2)startCooldown();
  ui();
}

function startEngine(){
  last=Date.now();
  if(state==="LOCKED")return msg("Unlock first","bad");
  engine=true;
  msg("Engine started","ok");
  log("Engine started");
  ui();
}

function lockSys(){
  state="LOCKED";
  engine=false;
  fails=0;
  msg("Locked","ok");
  log("Locked");
  ui();
}

function valetMode(){
  unlock();
}

function startCooldown(){
  cooldown=true;
  state="COOLDOWN";
  msg("Cooldown 10s","bad");
  log("Cooldown start");
  let t=10;
  const i=setInterval(()=>{
    t--;
    if(t<=0){
      clearInterval(i);
      cooldown=false;
      fails=0;
      state="LOCKED";
      msg("Cooldown ended","ok");
      log("Cooldown end");
      ui();
    }
  },1000);
}

function saveCodes(){
  const m=newMaster.value.trim();
  const v=newValet.value.trim();
  if(valid(m))localStorage.setItem("master",m);
  if(valid(v))localStorage.setItem("valet",v);
  master=localStorage.getItem("master");
  valet=localStorage.getItem("valet");
  msg("Codes saved","ok");
  log("Codes updated");
}

/* AUTO LOCK */
setInterval(()=>{
  if(Date.now()-last>60000 && state!=="LOCKED"){
    lockSys();
    msg("Auto locked","bad");
    log("Auto lock");
  }
},1000);

ui();
log("System ready");
</script>
</body>
</html>
