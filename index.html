<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Car Security System</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: Arial, sans-serif;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #000;
      background-image: url("background.gif");
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
    }

    .overlay {
      background: rgba(0, 0, 0, 0.82);
      padding: 24px 20px;
      border-radius: 18px;
      width: min(420px, 100% - 32px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
      border: 1px solid rgba(255, 255, 255, 0.08);
    }

    .title {
      text-align: center;
      font-size: 20px;
      margin-bottom: 6px;
      color: #fff;
    }

    .subtitle {
      text-align: center;
      font-size: 12px;
      color: #bbbbbb;
      margin-bottom: 14px;
    }

    input {
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: none;
      outline: none;
      background: #1f1f1f;
      color: #fff;
      font-size: 14px;
      margin-bottom: 10px;
    }

    button {
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: none;
      outline: none;
      cursor: pointer;
      font-size: 14px;
      margin-top: 6px;
      background: #272727;
      color: #fff;
      transition: background 0.15s, transform 0.1s;
    }

    button:hover {
      background: #353535;
      transform: translateY(-1px);
    }

    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-top: 4px;
    }

    .status-card {
      margin-top: 14px;
      padding: 12px;
      border-radius: 12px;
      background: #111111;
      border: 1px solid rgba(255, 255, 255, 0.05);
      color: #eee;
      font-size: 13px;
    }

    .status-line { margin-top: 4px; }

    .label {
      color: #888888;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .value {
      font-size: 14px;
      margin-top: 2px;
    }

    .engine-ui {
      display: flex;
      align-items: center;
      margin-top: 8px;
    }

    .engine-light {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      margin-right: 8px;
      background: #700000;
      box-shadow: 0 0 6px rgba(255, 0, 0, 0.4);
      transition: background 0.15s, box-shadow 0.15s, opacity 0.15s;
    }

    .engine-on {
      background: #00c853;
      box-shadow: 0 0 10px rgba(0, 200, 83, 0.7);
    }

    .blink-off {
      opacity: 0.25;
      box-shadow: none;
    }

    .engine-text-on { color: #00e676; }
    .engine-text-off { color: #ff5252; }

    .alert {
      margin-top: 10px;
      min-height: 20px;
      font-size: 13px;
    }

    .alert-success { color: #4caf50; }
    .alert-error { color: #f44336; }

    .small {
      font-size: 11px;
      color: #777;
      margin-top: 8px;
      text-align: right;
    }
  </style>
</head>
<body>

<div class="overlay">
  <div class="title">Car Security System</div>
  <div class="subtitle">Master, Valet, Cooldown, Auto-lock</div>

  <input id="passInput" placeholder="Enter passcode">

  <button id="unlockBtn">Unlock / Validate</button>

  <div class="row">
    <button id="startBtn">Start Engine</button>
    <button id="lockBtn">Lock</button>
  </div>

  <button id="valetBtn">Valet Mode</button>

  <div class="status-card">
    <div class="status-line">
      <div class="label">State</div>
      <div class="value" id="stateText">LOCKED</div>
    </div>

    <div class="status-line engine-ui">
      <div class="engine-light" id="engineLight"></div>
      <div class="value" id="engineText">Engine Off</div>
    </div>

    <div class="status-line">
      <div class="label">Fails</div>
      <div class="value" id="failsText">0 / 2</div>
    </div>

    <div class="status-line">
      <div class="label">Cooldown</div>
      <div class="value" id="cooldownText">Inactive</div>
    </div>
  </div>

  <div id="alert" class="alert"></div>
  <div class="small">Auto lock after 60 seconds of no input</div>
</div>

<script>
  // passcodes
  const MASTER_CODE = "1R2A";
  const VALET_CODE  = "123A";

  let state = "LOCKED";
  let engineOn = false;
  let failed = 0;
  let cooldown = false;
  let cooldownTimer = null;
  let inactivityTimer = null;

  const INACTIVITY_LIMIT = 60000;

  // elements
  const passInput = document.getElementById("passInput");
  const unlockBtn = document.getElementById("unlockBtn");
  const startBtn = document.getElementById("startBtn");
  const lockBtn = document.getElementById("lockBtn");
  const valetBtn = document.getElementById("valetBtn");

  const stateText = document.getElementById("stateText");
  const engineText = document.getElementById("engineText");
  const engineLight = document.getElementById("engineLight");
  const failsText = document.getElementById("failsText");
  const cooldownText = document.getElementById("cooldownText");
  const alertBox = document.getElementById("alert");

  // ---------------------------------------------------------
  // RECURSIVE FUNCTION — teacher-visible, clearly commented
  // ---------------------------------------------------------
  function recursiveCheck(code, index = 0) {

    // base case: reached the end → all characters valid
    if (index === code.length) {
      return true;
    }

    // check current character is a letter or digit
    const char = code[index];
    if (!/[A-Za-z0-9]/.test(char)) {
      return false;
    }

    // recursive step: check next character
    return recursiveCheck(code, index + 1);
  }
  // ---------------------------------------------------------

  function setAlert(msg, type) {
    alertBox.textContent = msg;
    alertBox.className = "alert";
    if (type === "success") alertBox.classList.add("alert-success");
    if (type === "error") alertBox.classList.add("alert-error");
  }

  function validateCodeFormat(code) {

    if (code.length < 4 || code.length > 8) {
      setAlert("Code must be 4–8 characters", "error");
      return false;
    }

    // USE RECURSION HERE
    if (!recursiveCheck(code)) {
      setAlert("Invalid characters found", "error");
      return false;
    }

    if (!/[A-Za-z]/.test(code) || !/[0-9]/.test(code)) {
      setAlert("Must contain at least one letter and one digit", "error");
      return false;
    }

    return true;
  }

  function resetInactivity() {
    if (inactivityTimer) clearTimeout(inactivityTimer);
    inactivityTimer = setTimeout(() => {
      state = "LOCKED";
      engineOn = false;
      failed = 0;
      setAlert("Auto locked from inactivity", "error");
      updateUI();
    }, INACTIVITY_LIMIT);
  }

  function updateUI() {
    stateText.textContent = state;
    failsText.textContent = failed + " / 2";
    cooldownText.textContent = cooldown ? "Active" : "Inactive";

    if (engineOn) {
      engineText.textContent = "Engine On";
      engineText.classList.add("engine-text-on");
      engineText.classList.remove("engine-text-off");
      engineLight.classList.add("engine-on");
    } else {
      engineText.textContent = "Engine Off";
      engineText.classList.add("engine-text-off");
      engineText.classList.remove("engine-text-on");
      engineLight.classList.remove("engine-on");
      engineLight.classList.remove("blink-off");
    }
  }

  function handleFailedAttempt() {
    failed++;
    setAlert("Invalid passcode (" + failed + "/2)", "error");
    if (failed >= 2) startCooldown();
  }

  function startCooldown() {
    cooldown = true;
    state = "COOLDOWN";
    let remaining = 10;
    setAlert("Cooldown " + remaining + " sec", "error");
    updateUI();

    if (cooldownTimer) clearInterval(cooldownTimer);
    cooldownTimer = setInterval(() => {
      remaining--;
      if (remaining <= 0) {
        clearInterval(cooldownTimer);
        cooldownTimer = null;
        cooldown = false;
        state = "LOCKED";
        failed = 0;
        setAlert("Cooldown ended", "success");
        updateUI();
      } else {
        setAlert("Cooldown " + remaining + " sec", "error");
      }
    }, 1000);
  }

  function unlockHandler() {
    if (cooldown) {
      setAlert("Cooldown active", "error");
      return;
    }

    const code = passInput.value.trim();

    if (!validateCodeFormat(code)) {
      failed++;
      if (failed >= 2) startCooldown();
      updateUI();
      resetInactivity();
      return;
    }

    if (code === MASTER_CODE) {
      state = "UNLOCKED";
      engineOn = true;
      failed = 0;
      setAlert("Master code accepted", "success");
    } else if (code === VALET_CODE) {
      state = "VALET";
      engineOn = false;
      failed = 0;
      setAlert("Valet mode active", "success");
    } else {
      handleFailedAttempt();
    }

    updateUI();
    resetInactivity();
  }

  function startEngineHandler() {
    if (state === "UNLOCKED" || state === "VALET") {
      engineOn = true;
      setAlert("Engine started", "success");
    } else {
      setAlert("Unlock or valet first", "error");
    }
    updateUI();
    resetInactivity();
  }

  function lockHandler() {
    state = "LOCKED";
    engineOn = false;
    failed = 0;
    setAlert("Car locked", "success");
    updateUI();
    resetInactivity();
  }

  function valetHandler() {
    const code = passInput.value.trim();

    if (!validateCodeFormat(code)) {
      failed++;
      if (failed >= 2) startCooldown();
      updateUI();
      resetInactivity();
      return;
    }

    if (code === VALET_CODE) {
      state = "VALET";
      engineOn = false;
      failed = 0;
      setAlert("Valet mode active", "success");
    } else {
      handleFailedAttempt();
    }

    updateUI();
    resetInactivity();
  }

  // blinking engine effect
  setInterval(() => {
    if (engineOn) {
      engineLight.classList.toggle("blink-off");
    } else {
      engineLight.classList.remove("blink-off");
    }
  }, 500);

  unlockBtn.addEventListener("click", unlockHandler);
  startBtn.addEventListener("click", startEngineHandler);
  lockBtn.addEventListener("click", lockHandler);
  valetBtn.addEventListener("click", valetHandler);
  passInput.addEventListener("input", resetInactivity);

  updateUI();
  resetInactivity();
</script>

</body>
</html>
